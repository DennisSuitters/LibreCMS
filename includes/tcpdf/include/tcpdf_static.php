<?php
//============================================================+
// File name   : tcpdf_static.php
// Version     : 1.0.004
// Begin       : 2002-08-03
// Last Update : 2014-09-02
// Author      : Nicola Asuni - Tecnick.com LTD - www.tecnick.com - info@tecnick.com
// License     : GNU-LGPL v3 (http://www.gnu.org/copyleft/lesser.html)
// -------------------------------------------------------------------
// Copyright (C) 2002-2014 Nicola Asuni - Tecnick.com LTD
//
// This file is part of TCPDF software library.
//
// TCPDF is free software: you can redistribute it and/or modify it
// under the terms of the GNU Lesser General Public License as
// published by the Free Software Foundation, either version 3 of the
// License, or (at your option) any later version.
//
// TCPDF is distributed in the hope that it will be useful, but
// WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
// See the GNU Lesser General Public License for more details.
//
// You should have received a copy of the License
// along with TCPDF. If not, see
// <http://www.tecnick.com/pagefiles/tcpdf/LICENSE.TXT>.
//
// See LICENSE.TXT file for more information.
// -------------------------------------------------------------------
//
// Description :
//   Static methods used by the TCPDF class.
//
//============================================================+
/**
 * @file
 * This is a PHP class that contains static methods for the TCPDF class.<br>
 * @package com.tecnick.tcpdf
 * @author Nicola Asuni
 * @version 1.0.004
 */
/**
 * @class TCPDF_STATIC
 * Static methods used by the TCPDF class.
 * @package com.tecnick.tcpdf
 * @brief PHP class for generating PDF documents without requiring external extensions.
 * @version 1.0.004
 * @author Nicola Asuni - info@tecnick.com
 * @mods StudioJunkyard for Libr8. (devel) <https://github.com/StudioJunkyard/Libr8>
 */class TCPDF_STATIC{private static$tcpdf_version='6.0.020';public static$alias_tot_pages='{:ptp:}';public static$alias_num_page='{:pnp:}';public static$alias_group_tot_pages='{:ptg:}';public static $alias_group_num_page='{:png:}';public static$alias_right_shift='{rsc:';public static$enc_padding="\x28\xBF\x4E\x5E\x4E\x75\x8A\x41\x64\x00\x4E\x56\xFF\xFA\x01\x08\x2E\x2E\x00\xB6\xD0\x68\x3E\x80\x2F\x0C\xA9\xFE\x64\x53\x69\x7A";public static$byterange_string='/ByteRange[0 ********** ********** **********]';public static$pageboxes=array('MediaBox','CropBox','BleedBox','TrimBox','ArtBox');public static function getTCPDFVersion(){return self::$tcpdf_version;}public static function getTCPDFProducer(){return "\x54\x43\x50\x44\x46\x20".self::getTCPDFVersion()."\x20\x28\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x74\x63\x70\x64\x66\x2e\x6f\x72\x67\x29";}public static function set_mqr($mqr){if(!defined('PHP_VERSION_ID')){$version=PHP_VERSION;define('PHP_VERSION_ID',(($version{0}*10000)+($version{2}*100)+$version{4}));}if(PHP_VERSION_ID<50300){@set_magic_quotes_runtime($mqr);}}public static function get_mqr(){if(!defined('PHP_VERSION_ID')){$version=PHP_VERSION;define('PHP_VERSION_ID',(($version{0}*10000)+($version{2}*100)+$version{4}));}if(PHP_VERSION_ID<50300){return@get_magic_quotes_runtime();}return0;}public static function getPageSizeFromFormat($format){switch(strtoupper($format)){case'A0':{$pf=array(2383.937,3370.394);break;}case'A1':{$pf=array(1683.780,2383.937);break;}case'A2':{$pf=array(1190.551,1683.780);break;}case'A3':{$pf=array(841.890,1190.551);break;}case'A4':{$pf=array(595.276,841.890);break;}case'A5':{$pf=array(419.528,595.276);break;}case'A6':{$pf=array(297.638,419.528);break;}case'A7':{$pf=array(209.764,297.638);break;}case'A8':{$pf=array(147.402,209.764);break;}case'A9':{$pf=array(104.882,147.402);break;}case'A10':{$pf=array(73.701,104.882);break;}case'A11':{$pf=array(51.024,73.701);break;}case'A12':{$pf=array(36.850,51.024);break;}case'B0':{$pf=array(2834.646,4008.189);break;}case'B1':{$pf=array(2004.094,2834.646);break;}case'B2':{$pf=array(1417.323,2004.094);break;}case'B3':{$pf=array(1000.630,1417.323);break;}case'B4':{$pf=array(708.661,1000.630);break;}case'B5':{$pf=array(498.898,708.661);break;}case'B6':{$pf=array(354.331,498.898);break;}case'B7':{$pf=array(249.449,354.331);break;}case'B8':{$pf=array(175.748,249.449);break;}case'B9':{$pf=array(124.724,175.748);break;}case'B10':{$pf=array(87.874,124.724);break;}case'B11':{$pf=array(62.362,87.874);break;}case'B12':{$pf=array(42.520,62.362);break;}case'C0':{$pf=array(2599.370,3676.535);break;}case'C1':{$pf=array(1836.850,2599.370);break;}case'C2':{$pf=array(1298.268,1836.850);break;}case'C3':{$pf=array(918.425,1298.268);break;}case'C4':{$pf=array(649.134,918.425);break;}case'C5':{$pf=array(459.213,649.134);break;}case'C6':{$pf=array(323.150,459.213);break;}case'C7':{$pf=array(229.606,323.150);break;}case'C8':{$pf=array(161.575,229.606);break;}case'C9':{$pf=array(113.386,161.575);break;}case'C10':{$pf=array(79.370,113.386);break;}case'C11':{$pf=array(56.693,79.370);break;}case'C12':{$pf=array(39.685,56.693);break;}case'C76':{$pf=array(229.606,459.213);break;}case'DL':{$pf=array(311.811,623.622);break;}case'E0':{$pf=array(2491.654,3517.795);break;}case'E1':{$pf=array(1757.480,2491.654);break;}case'E2':{$pf=array(1247.244,1757.480);break;}case'E3':{$pf=array(878.740,1247.244);break;}case'E4':{$pf=array(623.622,878.740);break;}case'E5':{$pf=array(439.370,623.622);break;}case'E6':{$pf=array(311.811,439.370);break;}case'E7':{$pf=array(221.102,311.811);break;}case'E8':{$pf=array(155.906,221.102);break;}case'E9':{$pf=array(110.551,155.906);break;}case'E10':{$pf=array(76.535,110.551);break;}case'E11':{$pf=array(53.858,76.535);break;}case'E12':{$pf=array(36.850,53.858);break;}case'G0':{$pf=array(2715.591,3838.110);break;}case'G1':{$pf=array(1919.055,2715.591);break;}case'G2':{$pf=array(1357.795,1919.055);break;}case'G3':{$pf=array(958.110,1357.795);break;}case'G4':{$pf=array(677.480,958.110);break;}case'G5':{$pf=array(479.055,677.480);break;}case'G6':{$pf=array(337.323,479.055);break;}case'G7':{$pf=array(238.110,337.323);break;}case'G8':{$pf=array(167.244,238.110);break;}case'G9':{$pf=array(119.055,167.244);break;}case'G10':{$pf=array(82.205,119.055);break;}case'G11':{$pf=array(59.528,82.205);break;}case'G12':{$pf=array(39.685,59.528);break;}case'RA0':{$pf=array(2437.795,3458.268);break;}case'RA1':{$pf=array(1729.134,2437.795);break;}case'RA2':{$pf=array(1218.898,1729.134);break;}case'RA3':{$pf=array(864.567,1218.898);break;}case'RA4':{$pf=array(609.449,864.567);break;}case'SRA0':{$pf=array(2551.181,3628.346);break;}case'SRA1':{$pf=array(1814.173,2551.181);break;}case'SRA2':{$pf=array(1275.591,1814.173);break;}case'SRA3':{$pf=array(907.087,1275.591);break;}case'SRA4':{$pf=array(637.795,907.087);break;}case'4A0':{$pf=array(4767.874,6740.787);break;}case'2A0':{$pf=array(3370.394,4767.874);break;}case'A2_EXTRA':{$pf=array(1261.417,1754.646);break;}case'A3+':{$pf=array(932.598,1369.134);break;}case'A3_EXTRA':{$pf=array(912.756,1261.417);break;}case'A3_SUPER':{$pf=array(864.567,1440.000);break;}case'SUPER_A3':{$pf=array(864.567,1380.472);break;}case'A4_EXTRA':{$pf=array(666.142,912.756);break;}case'A4_SUPER':{$pf=array(649.134,912.756);break;}case'SUPER_A4':{$pf=array(643.465,1009.134);break;}case'A4_LONG':{$pf=array(595.276,986.457);break;}case'F4':{$pf=array(595.276,935.433);break;}case'SO_B5_EXTRA':{$pf=array(572.598,782.362);break;}case'A5_EXTRA':{$pf=array(490.394,666.142);break;}case'ANSI_E':{$pf=array(2448.000,3168.000);break;}case'ANSI_D':{$pf=array(1584.000,2448.000);break;}case'ANSI_C':{$pf=array(1224.000,1584.000);break;}case'ANSI_B':{$pf=array(792.000,1224.000);break;}case'ANSI_A':{$pf=array(612.000,792.000);break;}case'USLEDGER':case'LEDGER':{$pf=array(1224.000,792.000);break;}case'ORGANIZERK':case'BIBLE':case'USTABLOID':case'TABLOID':{$pf=array(792.000,1224.000);break;}case'ORGANIZERM':case'USLETTER':case'LETTER':{$pf=array(612.000,792.000);break;}case'USLEGAL':case'LEGAL':{$pf=array(612.000,1008.000);break;}case'GOVERNMENTLETTER':case'GLETTER':{$pf=array(576.000,756.000);break;}case'JUNIORLEGAL':case'JLEGAL':{$pf=array(576.000,360.000);break;}case'QUADDEMY':{$pf=array(2520.000,3240.000);break;}case'SUPER_B':{$pf=array(936.000,1368.000);break;}case'QUARTO':{$pf=array(648.000,792.000);break;}case'GOVERNMENTLEGAL':case'FOLIO':{$pf=array(612.000,936.000);break;}case'MONARCH':case'EXECUTIVE':{$pf=array(522.000,756.000);break;}case'ORGANIZERL':case'STATEMENT':case'MEMO':{$pf=array(396.000,612.000);break;}case'FOOLSCAP':{$pf=array(595.440,936.000);break;}case'COMPACT':{$pf=array(306.000,486.000);break;}case'ORGANIZERJ':{$pf=array(198.000,360.000);break;}case'P1':{$pf=array(1587.402,2437.795);break;}case'P2':{$pf=array(1218.898,1587.402);break;}case'P3':{$pf=array(793.701,1218.898);break;}case'P4':{$pf=array(609.449,793.701);break;}case'P5':{$pf=array(396.850,609.449);break;}case'P6':{$pf=array(303.307,396.850);break;}case'ARCH_E':{$pf=array(2592.000,3456.000);break;}case'ARCH_E1':{$pf=array(2160.000,3024.000);break;}case'ARCH_D':{$pf=array(1728.000,2592.000);break;}case'BROADSHEET':case'ARCH_C':{$pf=array(1296.000,1728.000);break;}case'ARCH_B':{$pf=array(864.000,1296.000);break;}case'ARCH_A':{$pf=array(648.000,864.000);break;}case'ANNENV_A2':{$pf=array(314.640,414.000);break;}case'ANNENV_A6':{$pf=array(342.000,468.000);break;}case'ANNENV_A7':{$pf=array(378.000,522.000);break;}case'ANNENV_A8':{$pf=array(396.000,584.640);break;}case'ANNENV_A10':{$pf=array(450.000,692.640);break;}case'ANNENV_SLIM':{$pf=array(278.640,638.640);break;}case'COMMENV_N6_1/4':{$pf=array(252.000,432.000);break;}case'COMMENV_N6_3/4':{$pf=array(260.640,468.000);break;}case'COMMENV_N8':{$pf=array(278.640,540.000);break;}case'COMMENV_N9':{$pf=array(278.640,638.640);break;}case'COMMENV_N10':{$pf=array(296.640,684.000);break;}case'COMMENV_N11':{$pf=array(324.000,746.640);break;}case'COMMENV_N12':{$pf=array(342.000,792.000);break;}case'COMMENV_N14':{$pf=array(360.000,828.000);break;}case'CATENV_N1':{$pf=array(432.000,648.000);break;}case'CATENV_N1_3/4':{$pf=array(468.000,684.000);break;}case'CATENV_N2':{$pf=array(468.000,720.000);break;}case'CATENV_N3':{$pf=array(504.000,720.000);break;}case'CATENV_N6':{$pf=array(540.000,756.000);break;}case'CATENV_N7':{$pf=array(576.000,792.000);break;}case'CATENV_N8':{$pf=array(594.000,810.000);break;}case'CATENV_N9_1/2':{$pf=array(612.000,756.000);break;}case'CATENV_N9_3/4':{$pf=array(630.000,810.000);break;}case'CATENV_N10_1/2':{$pf=array(648.000,864.000);break;}case'CATENV_N12_1/2':{$pf=array(684.000,900.000);break;}case'CATENV_N13_1/2':{$pf=array(720.000,936.000);break;}case'CATENV_N14_1/4':{$pf=array(810.000,882.000);break;}case'CATENV_N14_1/2':{$pf=array(828.000,1044.000);break;}case'JIS_B0':{$pf=array(2919.685,4127.244);break;}case'JIS_B1':{$pf=array(2063.622,2919.685);break;}case'JIS_B2':{$pf=array(1459.843,2063.622);break;}case'JIS_B3':{$pf=array(1031.811,1459.843);break;}case'JIS_B4':{$pf=array(728.504,1031.811);break;}case'JIS_B5':{$pf=array(515.906,728.504);break;}case'JIS_B6':{$pf=array(362.835,515.906);break;}case'JIS_B7':{$pf=array(257.953,362.835);break;}case'JIS_B8':{$pf=array(181.417,257.953);break;}case'JIS_B9':{$pf=array(127.559,181.417);break;}case'JIS_B10':{$pf=array(90.709,127.559);break;}case'JIS_B11':{$pf=array(62.362,90.709);break;}case'JIS_B12':{$pf=array(45.354,62.362);break;}case'PA0':{$pf=array(2381.102,3174.803,);break;}case'PA1':{$pf=array(1587.402,2381.102);break;}case'PA2':{$pf=array(1190.551,1587.402);break;}case'PA3':{$pf=array(793.701,1190.551);break;}case'PA4':{$pf=array(595.276,793.701);break;}case'PA5':{$pf=array(396.850,595.276);break;}case'PA6':{$pf=array(297.638,396.850);break;}case'PA7':{$pf=array(198.425,297.638);break;}case'PA8':{$pf=array(147.402,198.425);break;}case'PA9':{$pf=array(99.213,147.402);break;}case'PA10':{$pf=array(73.701,99.213);break;}case'PASSPORT_PHOTO':{$pf=array(99.213,127.559);break;}case'E':{$pf=array(233.858,340.157);break;}case'L':case'3R':{$pf=array(252.283,360.000);break;}case'KG':case'4R':{$pf=array(289.134,430.866);break;}case'4D':{$pf=array(340.157,430.866);break;}case'2L':case'5R':{$pf=array(360.000,504.567);break;}case'8P':case'6R':{$pf=array(430.866,575.433);break;}case'6P':case'8R':{$pf=array(575.433,720.000);break;}case'6PW':case'S8R':{$pf=array(575.433,864.567);break;}case'4P':case'10R':{$pf=array(720.000,864.567);break;}case'4PW':case'S10R':{$pf=array(720.000,1080.000);break;}case'11R':{$pf=array(790.866,1009.134);break;}case'S11R':{$pf=array(790.866,1224.567);break;}case'12R':{$pf=array(864.567,1080.000);break;}case'S12R':{$pf=array(864.567,1292.598);break;}case'NEWSPAPER_BROADSHEET':{$pf=array(2125.984,1700.787);break;}case'NEWSPAPER_BERLINER':{$pf=array(1332.283,892.913);break;}case'NEWSPAPER_TABLOID':case'NEWSPAPER_COMPACT':{$pf=array(1218.898,793.701);break;}case'CREDIT_CARD':case'BUSINESS_CARD':case'BUSINESS_CARD_ISO7810':{$pf=array(153.014,242.646);break;}case'BUSINESS_CARD_ISO216':{$pf=array(147.402,209.764);break;}case'BUSINESS_CARD_IT':case'BUSINESS_CARD_UK':case'BUSINESS_CARD_FR':case'BUSINESS_CARD_DE':case'BUSINESS_CARD_ES':{$pf=array(155.906,240.945);break;}case'BUSINESS_CARD_CA':case'BUSINESS_CARD_US':{$pf=array(144.567,252.283);break;}case'BUSINESS_CARD_JP':{$pf=array(155.906,257.953);break;}case'BUSINESS_CARD_HK':{$pf=array(153.071,255.118);break;}case'BUSINESS_CARD_AU':case'BUSINESS_CARD_DK':case'BUSINESS_CARD_SE':{$pf=array(155.906,255.118);break;}case'BUSINESS_CARD_RU':case'BUSINESS_CARD_CZ':case'BUSINESS_CARD_FI':case'BUSINESS_CARD_HU':case'BUSINESS_CARD_IL':{$pf=array(141.732,255.118);break;}case'4SHEET':{$pf=array(2880.000,4320.000);break;}case'6SHEET':{$pf=array(3401.575,5102.362);break;}case'12SHEET':{$pf=array(8640.000,4320.000);break;}case'16SHEET':{$pf=array(5760.000,8640.000);break;}case'32SHEET':{$pf=array(11520.000,8640.000);break;}case'48SHEET':{$pf=array(17280.000,8640.000);break;}case'64SHEET':{$pf=array(23040.000,8640.000);break;}case'96SHEET':{$pf=array(34560.000,8640.000);break;}case'EN_EMPEROR':{$pf=array(3456.000,5184.000);break;}case'EN_ANTIQUARIAN':{$pf=array(2232.000,3816.000);break;}case'EN_GRAND_EAGLE':{$pf=array(2070.000,3024.000);break;}case'EN_DOUBLE_ELEPHANT':{$pf=array(1926.000,2880.000);break;}case'EN_ATLAS':{$pf=array(1872.000,2448.000);break;}case'EN_COLOMBIER':{$pf=array(1692.000,2484.000);break;}case'EN_ELEPHANT':{$pf=array(1656.000,2016.000);break;}case'EN_DOUBLE_DEMY':{$pf=array(1620.000,2556.000);break;}case'EN_IMPERIAL':{$pf=array(1584.000,2160.000);break;}case'EN_PRINCESS':{$pf=array(1548.000,2016.000);break;}case'EN_CARTRIDGE':{$pf=array(1512.000,1872.000);break;}case'EN_DOUBLE_LARGE_POST':{$pf=array(1512.000,2376.000);break;}case'EN_ROYAL':{$pf=array(1440.000,1800.000);break;}case'EN_SHEET':case'EN_HALF_POST':{$pf=array(1404.000,1692.000);break;}case'EN_SUPER_ROYAL':{$pf=array(1368.000,1944.000);break;}case'EN_DOUBLE_POST':{$pf=array(1368.000,2196.000);break;}case'EN_MEDIUM':{$pf=array(1260.000,1656.000);break;}case'EN_DEMY':{$pf=array(1260.000,1620.000);break;}case'EN_LARGE_POST':{$pf=array(1188.000,1512.000);break;}case'EN_COPY_DRAUGHT':{$pf=array(1152.000,1440.000);break;}case'EN_POST':{$pf=array(1116.000,1386.000);break;}case'EN_CROWN':{$pf=array(1080.000,1440.000);break;}case'EN_PINCHED_POST':{$pf=array(1062.000,1332.000);break;}case'EN_BRIEF':{$pf=array(972.000,1152.000);break;}case'EN_FOOLSCAP':{$pf=array(972.000,1224.000);break;}case'EN_SMALL_FOOLSCAP':{$pf=array(954.000,1188.000);break;}case'EN_POTT':{$pf=array(900.000,1080.000);break;}case'BE_GRAND_AIGLE':{$pf=array(1984.252,2948.031);break;}case'BE_COLOMBIER':{$pf=array(1757.480,2409.449);break;}case'BE_DOUBLE_CARRE':{$pf=array(1757.480,2607.874);break;}case'BE_ELEPHANT':{$pf=array(1746.142,2182.677);break;}case'BE_PETIT_AIGLE':{$pf=array(1700.787,2381.102);break;}case'BE_GRAND_JESUS':{$pf=array(1559.055,2069.291);break;}case'BE_JESUS':{$pf=array(1530.709,2069.291);break;}case'BE_RAISIN':{$pf=array(1417.323,1842.520);break;}case'BE_GRAND_MEDIAN':{$pf=array(1303.937,1714.961);break;}case'BE_DOUBLE_POSTE':{$pf=array(1233.071,1601.575);break;}case'BE_COQUILLE':{$pf=array(1218.898,1587.402);break;}case'BE_PETIT_MEDIAN':{$pf=array(1176.378,1502.362);break;}case'BE_RUCHE':{$pf=array(1020.472,1303.937);break;}case'BE_PROPATRIA':{$pf=array(977.953,1218.898);break;}case'BE_LYS':{$pf=array(898.583,1125.354);break;}case'BE_POT':{$pf=array(870.236,1088.504);break;}case'BE_ROSETTE':{$pf=array(765.354,983.622);break;}case'FR_UNIVERS':{$pf=array(2834.646,3685.039);break;}case'FR_DOUBLE_COLOMBIER':{$pf=array(2551.181,3571.654);break;}case'FR_GRANDE_MONDE':{$pf=array(2551.181,3571.654);break;}case'FR_DOUBLE_SOLEIL':{$pf=array(2267.717,3401.575);break;}case'FR_DOUBLE_JESUS':{$pf=array(2154.331,3174.803);break;}case'FR_GRAND_AIGLE':{$pf=array(2125.984,3004.724);break;}case'FR_PETIT_AIGLE':{$pf=array(1984.252,2664.567);break;}case'FR_DOUBLE_RAISIN':{$pf=array(1842.520,2834.646);break;}case'FR_JOURNAL':{$pf=array(1842.520,2664.567);break;}case'FR_COLOMBIER_AFFICHE':{$pf=array(1785.827,2551.181);break;}case'FR_DOUBLE_CAVALIER':{$pf=array(1757.480,2607.874);break;}case'FR_CLOCHE':{$pf=array(1700.787,2267.717);break;}case'FR_SOLEIL':{$pf=array(1700.787,2267.717);break;}case'FR_DOUBLE_CARRE':{$pf=array(1587.402,2551.181);break;}case'FR_DOUBLE_COQUILLE':{$pf=array(1587.402,2494.488);break;}case'FR_JESUS':{$pf=array(1587.402,2154.331);break;}case'FR_RAISIN':{$pf=array(1417.323,1842.520);break;}case'FR_CAVALIER':{$pf=array(1303.937,1757.480);break;}case'FR_DOUBLE_COURONNE':{$pf=array(1303.937,2040.945);break;}case'FR_CARRE':{$pf=array(1275.591,1587.402);break;}case'FR_COQUILLE':{$pf=array(1247.244,1587.402);break;}case'FR_DOUBLE_TELLIERE':{$pf=array(1247.244,1927.559);break;}case'FR_DOUBLE_CLOCHE':{$pf=array(1133.858,1700.787);break;}case'FR_DOUBLE_POT':{$pf=array(1133.858,1757.480);break;}case'FR_ECU':{$pf=array(1133.858,1474.016);break;}case'FR_COURONNE':{$pf=array(1020.472,1303.937);break;}case'FR_TELLIERE':{$pf=array(963.780,1247.244);break;}case'FR_POT':{$pf=array(878.740,1133.858);break;}default:{$pf=array(595.276,841.890);break;}}return$pf;}public static function setPageBoxes($page,$type,$llx,$lly,$urx,$ury,$points=false,$k,$pagedim=array()){if(!isset($pagedim[$page])){$pagedim[$page]=array();}if(!in_array($type,self::$pageboxes)){return;}if($points){$k=1;}$pagedim[$page][$type]['llx']=($llx*$k);$pagedim[$page][$type]['lly']=($lly*$k);$pagedim[$page][$type]['urx']=($urx*$k);$pagedim[$page][$type]['ury']=($ury*$k);return$pagedim;}public static function swapPageBoxCoordinates($page,$pagedim){foreach(self::$pageboxes as$type){if(isset($pagedim[$page][$type])){$tmp=$pagedim[$page][$type]['llx'];$pagedim[$page][$type]['llx']=$pagedim[$page][$type]['lly'];$pagedim[$page][$type]['lly']=$tmp;$tmp=$pagedim[$page][$type]['urx'];$pagedim[$page][$type]['urx']=$pagedim[$page][$type]['ury'];$pagedim[$page][$type]['ury']=$tmp;}}return$pagedim;}public static function getPageLayoutMode($layout='SinglePage'){switch($layout){case'default':case'single':case'SinglePage':{$layout_mode='SinglePage';break;}case'continuous':case'OneColumn':{$layout_mode='OneColumn';break;}case'two':case'TwoColumnLeft':{$layout_mode='TwoColumnLeft';break;}case'TwoColumnRight':{$layout_mode='TwoColumnRight';break;}case'TwoPageLeft':{$layout_mode='TwoPageLeft';break;}case'TwoPageRight':{$layout_mode='TwoPageRight';break;}default:{$layout_mode='SinglePage';}}return $layout_mode;}public static function getPageMode($mode='UseNone'){switch($mode){case'UseNone':{$page_mode='UseNone';break;}case'UseOutlines':{$page_mode='UseOutlines';break;}case'UseThumbs':{$page_mode='UseThumbs';break;}case'FullScreen':{$page_mode='FullScreen';break;}case'UseOC':{$page_mode='UseOC';break;}case'':{$page_mode='UseAttachments';break;}default:{$page_mode='UseNone';}}return$page_mode;}public static function isValidURL($url){$headers=@get_headers($url);return(strpos($headers[0],'200')!==false);}public static function removeSHY($txt='',$unicode=true){$txt=preg_replace('/([\\xc2]{1}[\\xad]{1})/','',$txt);if(!$unicode){$txt=preg_replace('/([\\xad]{1})/','',$txt);}return$txt;}public static function getBorderMode($brd,$position='start',$opencell=true){if((!$opencell)OR empty($brd)){return $brd;}if($brd==1){$brd='LTRB';}if(is_string($brd)){$slen=strlen($brd);$newbrd=array();for($i=0;$i<$slen;++$i){$newbrd[$brd[$i]]=array('cap'=>'square','join'=>'miter');}$brd=$newbrd;}foreach($brd as$border=>$style){switch($position){case'start':{if(strpos($border,'B')!==false){$newkey=str_replace('B','',$border);if(strlen($newkey)>0){$brd[$newkey]=$style;}unset($brd[$border]);}break;}case'middle':{if(strpos($border,'B')!==false){$newkey=str_replace('B','',$border);if(strlen($newkey)>0){$brd[$newkey]=$style;}unset($brd[$border]);$border=$newkey;}if(strpos($border,'T')!==false){$newkey=str_replace('T','',$border);if(strlen($newkey)>0){$brd[$newkey]=$style;}unset($brd[$border]);}break;}case'end':{if(strpos($border,'T')!==false){$newkey=str_replace('T','',$border);if(strlen($newkey)>0){$brd[$newkey]=$style;}unset($brd[$border]);}break;}}}return$brd;}public static function empty_string($str){return(is_null($str)OR(is_string($str)AND(strlen($str)==0)));}public static function getObjFilename($name){return tempnam(K_PATH_CACHE,$name.'_');}public static function _escape($s){return strtr($s,array(')'=>'\\)','('=>'\\(','\\'=>'\\\\',chr(13)=>'\r'));}public static function _escapeXML($str){$replaceTable=array("\0"=>'','&'=>'&amp;','<'=>'&lt;','>'=>'&gt;');$str=strtr($str,$replaceTable);return$str;}public static function objclone($object){if(($object instanceof Imagick)AND(version_compare(phpversion('imagick'),'3.0.1')!==1)){return@$object->clone();}return@clone($object);}public static function sendOutputData($data,$length){if(!isset($_SERVER['HTTP_ACCEPT_ENCODING'])OR empty($_SERVER['HTTP_ACCEPT_ENCODING'])){header('Content-Length: '.$length);}echo$data;}public static function replacePageNumAliases($page,$replace,$diff=0){foreach($replace as$rep){foreach($rep[3]as$a){if(strpos($page,$a)!==false){$page=str_replace($a,$rep[0],$page);$diff+=($rep[2]-$rep[1]);}}}return array($page,$diff);}public static function getTimestamp($date){if(($date[0]=='D')AND($date[1]==':')){$date=substr($date,2);}return strtotime($date);}public static function getFormattedDate($time){return substr_replace(date('YmdHisO',intval($time)),'\'',(0-2),0).'\'';}public static function _getULONG($str,$offset){$v=unpack('Ni',substr($str,$offset,4));return$v['i'];}public static function _getUSHORT($str,$offset){$v=unpack('ni',substr($str,$offset,2));return$v['i'];}public static function _getSHORT($str,$offset){$v=unpack('si',substr($str,$offset,2));return$v['i'];}public static function _getFWORD($str,$offset){$v=self::_getUSHORT($str,$offset);if($v>0x7fff){$v-=0x10000;}return $v;}public static function _getUFWORD($str,$offset){$v=self::_getUSHORT($str,$offset);return$v;}public static function _getFIXED($str,$offset){$m=self::_getFWORD($str,$offset);$f=self::_getUSHORT($str,($offset+2));$v=floatval(''.$m.'.'.$f.'');return$v;}public static function _getBYTE($str,$offset){$v=unpack('Ci',substr($str,$offset,1));return $v['i'];}public static function rfread($handle,$length){$data=fread($handle,$length);if($data===false){return false;}$rest=($length-strlen($data));if($rest>0){$data.=self::rfread($handle,$rest);}return$data;}public static function _freadint($f){$a=unpack('Ni',fread($f,4));return$a['i'];}public static function getRandomSeed($seed=''){$seed.=microtime();if(function_exists('openssl_random_pseudo_bytes')AND(strtoupper(substr(PHP_OS,0,3))!=='WIN')){$seed.=openssl_random_pseudo_bytes(512);}else{for($i=0;$i<23;++$i){$seed.=uniqid('',true);}}$seed.=uniqid('',true);$seed.=rand();$seed.=getmypid();$seed.=__FILE__;if(isset($_SERVER['REMOTE_ADDR'])){$seed.=$_SERVER['REMOTE_ADDR'];}if(isset($_SERVER['HTTP_USER_AGENT'])){$seed.=$_SERVER['HTTP_USER_AGENT'];}if(isset($_SERVER['HTTP_ACCEPT'])){$seed.=$_SERVER['HTTP_ACCEPT'];}if(isset($_SERVER['HTTP_ACCEPT_ENCODING'])){$seed.=$_SERVER['HTTP_ACCEPT_ENCODING'];}if(isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$seed.=$_SERVER['HTTP_ACCEPT_LANGUAGE'];}if(isset($_SERVER['HTTP_ACCEPT_CHARSET'])){$seed.=$_SERVER['HTTP_ACCEPT_CHARSET'];}$seed.=rand();$seed.=uniqid('',true);$seed.=microtime();return$seed;}public static function _md5_16($str){return pack('H*',md5($str));}public static function _AES($key,$text){$padding=16-(strlen($text)%16);$text.=str_repeat(chr($padding),$padding);$iv=mcrypt_create_iv(mcrypt_get_iv_size(MCRYPT_RIJNDAEL_128,MCRYPT_MODE_CBC),MCRYPT_RAND);$text=mcrypt_encrypt(MCRYPT_RIJNDAEL_128,$key,$text,MCRYPT_MODE_CBC,$iv);$text=$iv.$text;return$text;}public static function _RC4($key,$text,&$last_enc_key,&$last_enc_key_c){if(function_exists('mcrypt_decrypt')AND($out=@mcrypt_decrypt(MCRYPT_ARCFOUR,$key,$text,MCRYPT_MODE_STREAM,''))){return$out;}if($last_enc_key!=$key){$k=str_repeat($key,((256/strlen($key))+1));$rc4=range(0,255);$j=0;for($i=0;$i<256;++$i){$t=$rc4[$i];$j=($j+$t+ord($k[$i]))%256;$rc4[$i]=$rc4[$j];$rc4[$j]=$t;}$last_enc_key=$key;$last_enc_key_c=$rc4;}else{$rc4=$last_enc_key_c;}$len=strlen($text);$a=0;$b=0;$out='';for($i=0;$i<$len;++$i){$a=($a+1)%256;$t=$rc4[$a];$b=($b+$t)%256;$rc4[$a]=$rc4[$b];$rc4[$b]=$t;$k=$rc4[($rc4[$a]+$rc4[$b])%256];$out.=chr(ord($text[$i])^$k);}return$out;}public static function getUserPermissionCode($permissions,$mode=0){$options=array('owner'=>2,'print'=>4,'modify'=>8,'copy'=>16,'annot-forms'=>32,'fill-forms'=>256,'extract'=>512,'assemble'=>1024,'print-high'=>2048);$protection=2147422012;foreach($permissions as$permission){if(isset($options[$permission])){if(($mode>0)OR($options[$permission]<=32)){if($options[$permission]==2){$protection+=$options[$permission];}else{$protection-=$options[$permission];}}}}return$protection;}public static function convertHexStringToString($bs){$string='';$bslength=strlen($bs);if(($bslength%2)!=0){$bs.='0';++$bslength;}for($i=0;$i<$bslength;$i+=2){$string.=chr(hexdec($bs[$i].$bs[($i+1)]));}return$string;}public static function convertStringToHexString($s){$bs='';$chars=preg_split('//',$s,-1,PREG_SPLIT_NO_EMPTY);foreach($chars as$c){$bs.=sprintf('%02s',dechex(ord($c)));}return$bs;}public static function getEncPermissionsString($protection){$binprot=sprintf('%032b',$protection);$str=chr(bindec(substr($binprot,24,8)));$str.=chr(bindec(substr($binprot,16,8)));$str.=chr(bindec(substr($binprot,8,8)));$str.=chr(bindec(substr($binprot,0,8)));return$str;}public static function encodeNameObject($name){$escname='';$length=strlen($name);for($i=0;$i<$length;++$i){$chr=$name[$i];if(preg_match('/[0-9a-zA-Z]/',$chr)==1){$escname.=$chr;}else{$escname.=sprintf('#%02X',ord($chr));}}return$escname;}public static function getAnnotOptFromJSProp($prop,&$spot_colors,$rtl=false){if(isset($prop['aopt'])AND is_array($prop['aopt'])){return$prop['aopt'];}$opt=array();if(isset($prop['alignment'])){switch($prop['alignment']){case'left':{$opt['q']=0;break;}case'center':{$opt['q']=1;break;}case'right':{$opt['q']=2;break;}default:{$opt['q']=($rtl)?2:0;break;}}}if(isset($prop['lineWidth'])){$linewidth=intval($prop['lineWidth']);}else{$linewidth=1;}if(isset($prop['borderStyle'])){switch($prop['borderStyle']){case'border.d':case'dashed':{$opt['border']=array(0,0,$linewidth,array(3,2));$opt['bs']=array('w'=>$linewidth,'s'=>'D','d'=>array(3,2));break;}case'border.b':case'beveled':{$opt['border']=array(0,0,$linewidth);$opt['bs']=array('w'=>$linewidth,'s'=>'B');break;}case'border.i':case'inset':{$opt['border']=array(0,0,$linewidth);$opt['bs']=array('w'=>$linewidth,'s'=>'I');break;}case'border.u':case'underline':{$opt['border']=array(0,0,$linewidth);$opt['bs']=array('w'=>$linewidth,'s'=>'U');break;}case'border.s':case'solid':{$opt['border']=array(0,0,$linewidth);$opt['bs']=array('w'=>$linewidth,'s'=>'S');break;}default:{break;}}}if(isset($prop['border'])AND is_array($prop['border'])){$opt['border']=$prop['border'];}if(!isset($opt['mk'])){$opt['mk']=array();}if(!isset($opt['mk']['if'])){$opt['mk']['if']=array();}$opt['mk']['if']['a']=array(0.5,0.5);if(isset($prop['buttonAlignX'])){$opt['mk']['if']['a'][0]=$prop['buttonAlignX'];}if(isset($prop['buttonAlignY'])){$opt['mk']['if']['a'][1]=$prop['buttonAlignY'];}if(isset($prop['buttonFitBounds'])AND($prop['buttonFitBounds']=='true')){$opt['mk']['if']['fb']=true;}if(isset($prop['buttonScaleHow'])){switch($prop['buttonScaleHow']){case'scaleHow.proportional':{$opt['mk']['if']['s']='P';break;}case'scaleHow.anamorphic':{$opt['mk']['if']['s']='A';break;}}}if(isset($prop['buttonScaleWhen'])){switch($prop['buttonScaleWhen']){case'scaleWhen.always':{$opt['mk']['if']['sw']='A';break;}case'scaleWhen.never':{$opt['mk']['if']['sw']='N';break;}case'scaleWhen.tooBig':{$opt['mk']['if']['sw']='B';break;}case'scaleWhen.tooSmall':{$opt['mk']['if']['sw']='S';break;}}}if(isset($prop['buttonPosition'])){switch($prop['buttonPosition']){case 0:case'position.textOnly':{$opt['mk']['tp']=0;break;}case 1:case'position.iconOnly':{$opt['mk']['tp']=1;break;}case 2:case'position.iconTextV':{$opt['mk']['tp']=2;break;}case 3:case'position.textIconV':{$opt['mk']['tp']=3;break;}case 4:case'position.iconTextH':{$opt['mk']['tp']=4;break;}case 5:case'position.textIconH':{$opt['mk']['tp']=5;break;}case 6:case'position.overlay':{$opt['mk']['tp']=6;break;}}}if(isset($prop['fillColor'])){if(is_array($prop['fillColor'])){$opt['mk']['bg']=$prop['fillColor'];}else{$opt['mk']['bg']=TCPDF_COLORS::convertHTMLColorToDec($prop['fillColor'],$spot_colors);}}if(isset($prop['strokeColor'])){if(is_array($prop['strokeColor'])){$opt['mk']['bc']=$prop['strokeColor'];}else{$opt['mk']['bc']=TCPDF_COLORS::convertHTMLColorToDec($prop['strokeColor'],$spot_colors);}}if(isset($prop['rotation'])){$opt['mk']['r']=$prop['rotation'];}if(isset($prop['charLimit'])){$opt['maxlen']=intval($prop['charLimit']);}if(!isset($ff)){$ff=0;}if(isset($prop['readonly'])AND($prop['readonly']=='true')){$ff+=1<<0;}if(isset($prop['required'])AND($prop['required']=='true')){$ff+=1<<1;}if(isset($prop['multiline'])AND($prop['multiline']=='true')){$ff+=1<<12;}if(isset($prop['password'])AND($prop['password']=='true')){$ff+=1<<13;}if(isset($prop['NoToggleToOff'])AND($prop['NoToggleToOff']=='true')){$ff+=1<<14;}if(isset($prop['Radio'])AND($prop['Radio']=='true')){$ff+=1<<15;}if(isset($prop['Pushbutton'])AND($prop['Pushbutton']=='true')){$ff+=1<<16;}if(isset($prop['Combo'])AND($prop['Combo']=='true')){$ff+=1<<17;}if(isset($prop['editable'])AND($prop['editable']=='true')){$ff+=1<<18;}if(isset($prop['Sort'])AND($prop['Sort']=='true')){$ff+=1<<19;}if(isset($prop['fileSelect'])AND($prop['fileSelect']=='true')){$ff+=1<<20;}if(isset($prop['multipleSelection'])AND($prop['multipleSelection']=='true')){$ff+=1<<21;}if(isset($prop['doNotSpellCheck'])AND($prop['doNotSpellCheck']=='true')){$ff+=1<<22;}if(isset($prop['doNotScroll'])AND($prop['doNotScroll']=='true')){$ff+=1<<23;}if(isset($prop['comb'])AND($prop['comb']=='true')){$ff+=1<<24;}if(isset($prop['radiosInUnison'])AND($prop['radiosInUnison']=='true')){$ff+=1<<25;}if(isset($prop['richText'])AND($prop['richText']=='true')){$ff+=1<<25;}if(isset($prop['commitOnSelChange'])AND($prop['commitOnSelChange']=='true')){$ff+=1<<26;}$opt['ff']=$ff;if(isset($prop['defaultValue'])){$opt['dv']=$prop['defaultValue'];}$f=4;if(isset($prop['readonly'])AND($prop['readonly']=='true')){$f+=1<<6;}if(isset($prop['display'])){if($prop['display']=='display.visible'){}elseif($prop['display']=='display.hidden'){$f+=1<<1;}elseif($prop['display']=='display.noPrint'){$f-=1<<2;}elseif($prop['display']=='display.noView'){$f+=1<<5;}}$opt['f']=$f;if(isset($prop['currentValueIndices'])AND is_array($prop['currentValueIndices'])){$opt['i']=$prop['currentValueIndices'];}if(isset($prop['value'])){if(is_array($prop['value'])){$opt['opt']=array();foreach($prop['value']AS$key=>$optval){if(isset($prop['exportValues'][$key])){$opt['opt'][$key]=array($prop['exportValues'][$key],$prop['value'][$key]);}else{$opt['opt'][$key]=$prop['value'][$key];}}}else{$opt['v']=$prop['value'];}}if(isset($prop['richValue'])){$opt['rv']=$prop['richValue'];}if(isset($prop['submitName'])){$opt['tm']=$prop['submitName'];}if(isset($prop['name'])){$opt['t']=$prop['name'];}if(isset($prop['userName'])){$opt['tu']=$prop['userName'];}if(isset($prop['highlight'])){switch($prop['highlight']){case'none':case'highlight.n':{$opt['h']='N';break;}case'invert':case'highlight.i':{$opt['h']='i';break;}case'push':case'highlight.p':{$opt['h']='P';break;}case'outline':case'highlight.o':{$opt['h']='O';break;}}}return$opt;}public static function formatPageNumber($num){return number_format((float)$num,0,'','.');}public static function formatTOCPageNumber($num){return number_format((float)$num,0,'','.');}public static function extractCSSproperties($cssdata){if(empty($cssdata)){return array();}$cssdata=preg_replace('/\/\*[^\*]*\*\//','',$cssdata);$cssdata=preg_replace('/[\s]+/',' ',$cssdata);$cssdata=preg_replace('/[\s]*([;:\{\}]{1})[\s]*/','\\1',$cssdata);$cssdata=preg_replace('/([^\}\{]+)\{\}/','',$cssdata);$cssdata=preg_replace('/@media[\s]+([^\{]*)\{/i','@media \\1Â§',$cssdata);$cssdata=preg_replace('/\}\}/si','}Â§',$cssdata);$cssdata=trim($cssdata);$cssblocks=array();$matches=array();if(preg_match_all('/@media[\s]+([^\Â§]*)Â§([^Â§]*)Â§/i',$cssdata,$matches)>0){foreach($matches[1]as$key=>$type){$cssblocks[$type]=$matches[2][$key];}$cssdata=preg_replace('/@media[\s]+([^\Â§]*)Â§([^Â§]*)Â§/i','',$cssdata);}if(isset($cssblocks['all'])AND!empty($cssblocks['all'])){$cssdata.=$cssblocks['all'];}if(isset($cssblocks['print'])AND!empty($cssblocks['print'])){$cssdata.=$cssblocks['print'];}$cssblocks=array();$matches=array();if(substr($cssdata,-1)=='}'){$cssdata=substr($cssdata,0,-1);}$matches=explode('}',$cssdata);foreach($matches as$key=>$block){$cssblocks[$key]=explode('{',$block);if(!isset($cssblocks[$key][1])){unset($cssblocks[$key]);}}foreach($cssblocks as$key=>$block){if(strpos($block[0],',')>0){$selectors=explode(',',$block[0]);foreach($selectors as$sel){$cssblocks[]=array(0=>trim($sel),1=>$block[1]);}unset($cssblocks[$key]);}}$cssdata=array();foreach($cssblocks as$block){$selector=$block[0];$matches=array();$a=0;$b=intval(preg_match_all('/[\#]/',$selector,$matches));$c=intval(preg_match_all('/[\[\.]/',$selector,$matches));$c+=intval(preg_match_all('/[\:]link|visited|hover|active|focus|target|lang|enabled|disabled|checked|indeterminate|root|nth|first|last|only|empty|contains|not/i',$selector,$matches));$d=intval(preg_match_all('/[\>\+\~\s]{1}[a-zA-Z0-9]+/',' '.$selector,$matches));$d+=intval(preg_match_all('/[\:][\:]/',$selector,$matches));$specificity=$a.$b.$c.$d;$cssdata[$specificity.' '.$selector]=$block[1];}ksort($cssdata,SORT_STRING);return$cssdata;}public static function fixHTMLCode($html,$default_css='',$tagvs='',$tidy_options='',&$tagvspaces){if($tidy_options===''){$tidy_options=array('clean'=>1,'drop-empty-paras'=>0,'drop-proprietary-attributes'=>1,'fix-backslash'=>1,'hide-comments'=>1,'join-styles'=>1,'lower-literals'=>1,'merge-divs'=>1,'merge-spans'=>1,'output-xhtml'=>1,'word-2000'=>1,'wrap'=>0,'output-bom'=>0,);}$tidy=tidy_parse_string($html,$tidy_options);$tidy->cleanRepair();$tidy_head=tidy_get_head($tidy);$css=$tidy_head->value;$css=preg_replace('/<style([^>]+)>/ims','<style>',$css);$css=preg_replace('/<\/style>(.*)<style>/ims',"\n",$css);$css=str_replace('/*<![CDATA[*/','',$css);$css=str_replace('/*]]>*/','',$css);preg_match('/<style>(.*)<\/style>/ims',$css,$matches);if(isset($matches[1])){$css=strtolower($matches[1]);}else{$css='';}$css='<style>'.$default_css.$css.'</style>';$tidy_body=tidy_get_body($tidy);$html=$tidy_body->value;$html=str_replace('<br>','<br />',$html);$html=preg_replace('/<div([^\>]*)><\/div>/','',$html);$html=preg_replace('/<p([^\>]*)><\/p>/','',$html);if($tagvs!==''){$tagvspaces=$tagvs;}return$css.$html;}public static function isValidCSSSelectorForTag($dom,$key,$selector){$valid=false;$tag=$dom[$key]['value'];$class=array();if(isset($dom[$key]['attribute']['class'])AND!empty($dom[$key]['attribute']['class'])){$class=explode(' ',strtolower($dom[$key]['attribute']['class']));}$id='';if(isset($dom[$key]['attribute']['id'])AND!empty($dom[$key]['attribute']['id'])){$id=strtolower($dom[$key]['attribute']['id']);}$selector=preg_replace('/([\>\+\~\s]{1})([\.]{1})([^\>\+\~\s]*)/si','\\1*.\\3',$selector);$matches=array();if(preg_match_all('/([\>\+\~\s]{1})([a-zA-Z0-9\*]+)([^\>\+\~\s]*)/si',$selector,$matches,PREG_PATTERN_ORDER|PREG_OFFSET_CAPTURE)>0){$parentop=array_pop($matches[1]);$operator=$parentop[0];$offset=$parentop[1];$lasttag=array_pop($matches[2]);$lasttag=strtolower(trim($lasttag[0]));if(($lasttag=='*')OR($lasttag==$tag)){$attrib=array_pop($matches[3]);$attrib=strtolower(trim($attrib[0]));if(!empty($attrib)){switch($attrib{0}){case'.':{if(in_array(substr($attrib,1),$class)){$valid=true;}break;}case'#':{if(substr($attrib,1)==$id){$valid=true;}break;}case'[':{$attrmatch=array();if(preg_match('/\[([a-zA-Z0-9]*)[\s]*([\~\^\$\*\|\=]*)[\s]*["]?([^"\]]*)["]?\]/i',$attrib,$attrmatch)>0){$att=strtolower($attrmatch[1]);$val=$attrmatch[3];if(isset($dom[$key]['attribute'][$att])){switch($attrmatch[2]){case'=':{if($dom[$key]['attribute'][$att]==$val){$valid=true;}break;}case'~=':{if(in_array($val,explode(' ',$dom[$key]['attribute'][$att]))){$valid=true;}break;}case'^=':{if($val==substr($dom[$key]['attribute'][$att],0,strlen($val))){$valid=true;}break;}case'$=':{if($val==substr($dom[$key]['attribute'][$att],-strlen($val))){$valid=true;}break;}case'*=':{if(strpos($dom[$key]['attribute'][$att],$val)!==false){$valid=true;}break;}case'|=':{if($dom[$key]['attribute'][$att]==$val){$valid=true;}elseif(preg_match('/'.$val.'[\-]{1}/i',$dom[$key]['attribute'][$att])>0){$valid=true;}break;}default:{$valid=true;}}}}break;}case':':{if($attrib{1}==':'){}else{}break;}}}else{$valid=true;}if($valid AND($offset>0)){$valid=false;$selector=substr($selector,0,$offset);switch($operator){case' ':{while($dom[$key]['parent']>0){if(self::isValidCSSSelectorForTag($dom,$dom[$key]['parent'],$selector)){$valid=true;break;}else{$key=$dom[$key]['parent'];}}break;}case'>':{$valid=self::isValidCSSSelectorForTag($dom,$dom[$key]['parent'],$selector);break;}case'+':{for($i=($key-1);$i>$dom[$key]['parent'];--$i){if($dom[$i]['tag']AND$dom[$i]['opening']){$valid=self::isValidCSSSelectorForTag($dom,$i,$selector);break;}}break;}case'~':{for($i=($key-1);$i>$dom[$key]['parent'];--$i){if($dom[$i]['tag']AND$dom[$i]['opening']){if(self::isValidCSSSelectorForTag($dom,$i,$selector)){break;}}}break;}}}}}return$valid;}public static function getCSSdataArray($dom,$key,$css){$cssarray=array();$selectors=array();if(isset($dom[($dom[$key]['parent'])]['csssel'])){$selectors=$dom[($dom[$key]['parent'])]['csssel'];}foreach($css as$selector=>$style){$pos=strpos($selector,' ');$specificity=substr($selector,0,$pos);$selector=substr($selector,$pos);if(self::isValidCSSSelectorForTag($dom,$key,$selector)){if(!in_array($selector,$selectors)){$cssarray[]=array('k'=>$selector,'s'=>$specificity,'c'=>$style);$selectors[]=$selector;}}}if(isset($dom[$key]['attribute']['style'])){$cssarray[]=array('k'=>'','s'=>'1000','c'=>$dom[$key]['attribute']['style']);}$cssordered=array();foreach($cssarray as$key=>$val){$skey=sprintf('%04d',$key);$cssordered[$val['s'].'_'.$skey]=$val;}ksort($cssordered,SORT_STRING);return array($selectors,$cssordered);}public static function getTagStyleFromCSSarray($css){$tagstyle='';foreach($css as$style){$csscmds=explode(';',$style['c']);foreach($csscmds as$cmd){if(!empty($cmd)){$pos=strpos($cmd,':');if($pos!==false){$cmd=substr($cmd,0,($pos+1));if(strpos($tagstyle,$cmd)!==false){$tagstyle=preg_replace('/'.$cmd.'[^;]+/i','',$tagstyle);}}}}$tagstyle.=';'.$style['c'];}$tagstyle=preg_replace('/[;]+/',';',$tagstyle);return$tagstyle;}public static function intToRoman($number){$roman='';while($number>=1000){$roman.='M';$number-=1000;}while($number>=900){$roman.='CM';$number-=900;}while($number>=500){$roman.='D';$number-=500;}while($number>=400){$roman.='CD';$number-=400;}while($number>=100){$roman.='C';$number-=100;}while($number>=90){$roman.='XC';$number-=90;}while($number>=50){$roman.='L';$number-=50;}while($number>=40){$roman.='XL';$number-=40;}while($number>=10){$roman.='X';$number-=10;}while($number>=9){$roman.='IX';$number-=9;}while($number>=5){$roman.='V';$number-=5;}while($number>=4){$roman.='IV';$number-=4;}while($number>=1){$roman.='I';--$number;}return$roman;}public static function revstrpos($haystack,$needle,$offset=0){$length=strlen($haystack);$offset=($offset>0)?($length-$offset):abs($offset);$pos=strpos(strrev($haystack),strrev($needle),$offset);return($pos===false)?false:($length-$pos-strlen($needle));}public static function serializeTCPDFtagParameters($pararray){return urlencode(serialize($pararray));}public static function getHyphenPatternsFromTEX($file){$data=file_get_contents($file);$patterns=array();$data=preg_replace('/\%[^\n]*/','',$data);preg_match('/\\\\patterns\{([^\}]*)\}/i',$data,$matches);$data=trim(substr($matches[0],10,-1));$patterns_array=preg_split('/[\s]+/',$data);$patterns=array();foreach($patterns_array as$val){if(!TCPDF_STATIC::empty_string($val)){$val=trim($val);$val=str_replace('\'','\\\'',$val);$key=preg_replace('/[0-9]+/','',$val);$patterns[$key]=$val;}}return $patterns;}public static function getPathPaintOperator($style,$default='S'){$op='';switch($style){case'S':case'D':{$op='S';break;}case's':case'd':{$op='s';break;}case'f':case'F':{$op='f';break;}case'f*':case'F*':{$op='f*';break;}case'B':case'FD':case'DF':{$op='B';break;}case'B*':case'F*D':case'DF*':{$op='B*';break;}case'b':case'fd':case'df':{$op='b';break;}case'b*':case'f*d':case'df*':{$op='b*';break;}case'CNZ':{$op='W n';break;}case'CEO':{$op='W* n';break;}case'n':{$op='n';break;}default:{if(!empty($default)){$op=self::getPathPaintOperator($default,'');}else{$op='';}}}return $op;}public static function getTransformationMatrixProduct($ta,$tb){$tm=array();$tm[0]=($ta[0]*$tb[0])+($ta[2]*$tb[1]);$tm[1]=($ta[1]*$tb[0])+($ta[3]*$tb[1]);$tm[2]=($ta[0]*$tb[2])+($ta[2]*$tb[3]);$tm[3]=($ta[1]*$tb[2])+($ta[3]*$tb[3]);$tm[4]=($ta[0]*$tb[4])+($ta[2]*$tb[5])+$ta[4];$tm[5]=($ta[1]*$tb[4])+($ta[3]*$tb[5])+$ta[5];return$tm;}public static function getSVGTransformMatrix($attribute){$tm=array(1,0,0,1,0,0);$transform=array();if(preg_match_all('/(matrix|translate|scale|rotate|skewX|skewY)[\s]*\(([^\)]+)\)/si',$attribute,$transform,PREG_SET_ORDER)>0){foreach($transform as$key=>$data){if(!empty($data[2])){$a=1;$b=0;$c=0;$d=1;$e=0;$f=0;$regs=array();switch($data[1]){case'matrix':{if(preg_match('/([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)/si',$data[2],$regs)){$a=$regs[1];$b=$regs[2];$c=$regs[3];$d=$regs[4];$e=$regs[5];$f=$regs[6];}break;}case'translate':{if(preg_match('/([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)/si',$data[2],$regs)){$e=$regs[1];$f=$regs[2];}elseif(preg_match('/([a-z0-9\-\.]+)/si',$data[2],$regs)){$e=$regs[1];}break;}case'scale':{if(preg_match('/([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)/si',$data[2],$regs)){$a=$regs[1];$d=$regs[2];}elseif(preg_match('/([a-z0-9\-\.]+)/si',$data[2],$regs)){$a=$regs[1];$d=$a;}break;}case'rotate':{if(preg_match('/([0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)/si',$data[2],$regs)){$ang=deg2rad($regs[1]);$x=$regs[2];$y=$regs[3];$a=cos($ang);$b=sin($ang);$c=-$b;$d=$a;$e=($x*(1-$a))-($y*$c);$f=($y*(1-$d))-($x*$b);}elseif(preg_match('/([0-9\-\.]+)/si',$data[2],$regs)){$ang=deg2rad($regs[1]);$a=cos($ang);$b=sin($ang);$c=-$b;$d=$a;$e=0;$f=0;}break;}case'skewX':{if(preg_match('/([0-9\-\.]+)/si',$data[2],$regs)){$c=tan(deg2rad($regs[1]));}break;}case'skewY':{if(preg_match('/([0-9\-\.]+)/si',$data[2],$regs)){$b=tan(deg2rad($regs[1]));}break;}}$tm=self::getTransformationMatrixProduct($tm,array($a,$b,$c,$d,$e,$f));}}}return$tm;}public static function getVectorsAngle($x1,$y1,$x2,$y2){$dprod=($x1*$x2)+($y1*$y2);$dist1=sqrt(($x1*$x1)+($y1*$y1));$dist2=sqrt(($x2*$x2)+($y2*$y2));$angle=acos($dprod/($dist1*$dist2));if(is_nan($angle)){$angle=M_PI;}if((($x1*$y2)-($x2*$y1))<0){$angle*=-1;}return$angle;}}